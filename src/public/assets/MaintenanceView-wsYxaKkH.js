import{_ as S,o as e,c as t,x as f,y as x,b as _,w as p,a as c,t as u,u as r,h as v,z as q,aE as $,aF as P,n as L,j as w,d as b,s as B,r as m,a1 as E}from"./index-Dq3TnNJu.js";import{B as T}from"./Button-B-y_Fy3n.js";import{a as k,b as U,N as A}from"./Space-C_T_MHn6.js";import{u as D}from"./use-message-CJ8uyTkj.js";const I={class:"quick-actions-grid"},M={class:"quick-action-content"},Q={class:"quick-action-info"},R={class:"quick-action-title"},F={class:"quick-action-desc"},J={__name:"QuickActions",emits:["success","error","connectivity","cups-logs"],setup(d,{emit:l}){const s=l,a=q({clearQueues:!1,restartCups:!1,connectivity:!1,cupsLogs:!1}),y=[{key:"clearQueues",title:"清空打印队列",desc:"清空所有队列中的等待和处理中的任务",label:"清空队列",btnType:"error",handler:async()=>{await $("/api/maintenance/queues/clear"),s("success","队列已清空")}},{key:"restartCups",title:"重启 CUPS 服务",desc:"重启系统 CUPS 打印服务",label:"重启 CUPS",btnType:"warning",handler:async()=>{await $("/api/maintenance/cups/restart"),s("success","CUPS 服务已重启")}},{key:"connectivity",title:"检测打印机连通性",desc:"检测所有打印机的网络连通性",label:"开始检测",btnType:"default",handler:async()=>{const i=await P("/api/maintenance/printers/connectivity");s("connectivity",i.results||[])}},{key:"cupsLogs",title:"查看 CUPS 日志",desc:"获取 CUPS 错误日志",label:"获取日志",btnType:"default",handler:async()=>{const i=await P("/api/maintenance/cups/logs?lines=200");s("cups-logs",i.logs||"")}}];async function h(i){a[i.key]=!0;try{await i.handler()}catch(C){s("error",i.title+"失败: "+(C.message||"未知错误"))}finally{a[i.key]=!1}}return(i,C)=>(e(),t("div",I,[(e(),t(f,null,x(y,o=>_(r(k),{key:o.key,size:"small"},{default:p(()=>[c("div",M,[c("div",Q,[c("div",R,u(o.title),1),c("div",F,u(o.desc),1)]),_(r(T),{type:o.btnType,loading:a[o.key],disabled:a[o.key],size:"small",onClick:z=>h(o)},{default:p(()=>[v(u(o.label),1)]),_:2},1032,["type","loading","disabled","onClick"])])]),_:2},1024)),64))]))}},O=S(J,[["__scopeId","data-v-5965c6c3"]]),j={class:"diag-results"},H={class:"diag-icon"},G={class:"diag-name"},K={class:"diag-detail"},W={__name:"DiagResult",props:{results:{type:Array,default:()=>[]}},setup(d){return(l,s)=>(e(),t("div",j,[(e(!0),t(f,null,x(d.results,(a,y)=>(e(),t("div",{key:y,class:L(["diag-item","diag-"+a.status])},[c("span",H,[a.status==="ok"?(e(),t(f,{key:0},[v("✓")],64)):a.status==="warning"?(e(),t(f,{key:1},[v("⚠")],64)):(e(),t(f,{key:2},[v("✗")],64))]),c("span",G,u(a.name),1),c("span",K,u(a.detail),1)],2))),128)),!d.results||d.results.length===0?(e(),w(r(U),{key:0,description:"暂无诊断结果"})):b("",!0)]))}},X=S(W,[["__scopeId","data-v-70957202"]]),Y={key:0,class:"cups-log-container"},Z={__name:"CupsLogViewer",props:{logs:{type:String,default:""}},setup(d){const l=d,s=m(null);return B(()=>l.logs,async()=>{l.logs&&s.value&&(await E(),s.value.scrollTop=s.value.scrollHeight)}),(a,y)=>d.logs?(e(),t("div",Y,[c("pre",{ref_key:"logPre",ref:s,class:"cups-log-pre"},u(d.logs),513)])):(e(),w(r(U),{key:1,description:"点击「获取日志」查看 CUPS 日志"}))}},ee=S(Z,[["__scopeId","data-v-92a29e5c"]]),se={class:"maintenance-view"},ae={class:"connectivity-results"},te={class:"connectivity-name"},ne={class:"connectivity-status"},ce={__name:"MaintenanceView",setup(d){const l=D(),s=m(!1),a=m([]),y=m([]),h=m(null);function i(n){l.success(n)}function C(n){l.error(n)}function o(n){y.value=n,l.info("连通性检测完成")}function z(n){h.value=n}async function V(){s.value=!0;try{const n=await $("/api/maintenance/diagnostics");a.value=n.results||[],l.success("诊断完成")}catch(n){l.error("诊断失败: "+(n.message||"未知错误"))}finally{s.value=!1}}return(n,N)=>(e(),t("div",se,[_(r(A),{vertical:"",size:16},{default:p(()=>[_(r(k),{title:"快速操作",size:"small"},{default:p(()=>[_(O,{onSuccess:i,onError:C,onConnectivity:o,onCupsLogs:z})]),_:1}),_(r(k),{title:"系统诊断",size:"small"},{"header-extra":p(()=>[_(r(T),{type:"info",size:"small",loading:s.value,onClick:V},{default:p(()=>[...N[0]||(N[0]=[v(" 一键诊断 ",-1)])]),_:1},8,["loading"])]),default:p(()=>[_(X,{results:a.value},null,8,["results"])]),_:1}),y.value.length>0?(e(),w(r(k),{key:0,title:"连通性检测结果",size:"small"},{default:p(()=>[c("div",ae,[(e(!0),t(f,null,x(y.value,g=>(e(),t("div",{key:g.name,class:"connectivity-item"},[c("span",{class:L(["connectivity-icon",g.reachable?"reachable":"unreachable"])},u(g.reachable?"✓":"✗"),3),c("span",te,u(g.name),1),c("span",ne,[v(u(g.reachable?"可达":"不可达")+" ",1),g.error?(e(),t(f,{key:0},[v(" ("+u(g.error)+")",1)],64)):b("",!0)])]))),128))])]),_:1})):b("",!0),h.value!==null?(e(),w(r(k),{key:1,title:"CUPS 日志",size:"small"},{default:p(()=>[_(ee,{logs:h.value},null,8,["logs"])]),_:1})):b("",!0)]),_:1})]))}},ue=S(ce,[["__scopeId","data-v-de7ac485"]]);export{ue as default};
