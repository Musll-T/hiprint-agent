import{_ as I,o as r,j as y,w as n,a as c,c as g,t as w,d as N,b as o,u as l,h as U,n as T,m as z,q as B,s as F,r as D,v as A,x as O,y as H,z as K}from"./index-Dq3TnNJu.js";import{_ as G,N as J,P as Q}from"./PullRefresh-CkOp9HoH.js";import{N as V,a as W,b as X}from"./Space-C_T_MHn6.js";import{B as C}from"./Button-B-y_Fy3n.js";import{N as Y}from"./Tag-D463yQp-.js";import{u as E}from"./use-message-CJ8uyTkj.js";import{a as $,N as Z}from"./FormItem-JjeF8lCF.js";import{N as x}from"./Input-WxvPfhkY.js";import{u as _}from"./composables-CWfVvcRf.js";import"./context-CuSugIpk.js";const ee={class:"printer-card-header"},te={class:"printer-name"},ae={class:"printer-detail"},le={key:0,class:"detail-row"},ie={class:"detail-value"},se={key:1,class:"detail-row"},ne={class:"detail-value"},re={key:2,class:"detail-row"},de={class:"detail-value"},oe={key:3,class:"detail-row"},ue={class:"detail-value uri-text"},ce={key:4,class:"detail-row"},ve={class:"detail-value"},pe={__name:"PrinterCard",props:{printer:{type:Object,required:!0},actionLoading:{type:String,default:""}},emits:["edit","delete","setDefault","enable","disable"],setup(a,{emit:f}){const t=a,m=f,u=z(()=>{const i=(t.printer.status||"").toLowerCase();return i==="idle"||i.includes("idle")?"idle":i.includes("printing")||i.includes("processing")?"printing":"stopped"}),P=z(()=>{const i=u.value;return i==="idle"?"dot-ready":i==="printing"?"dot-busy":"dot-stopped"}),L=z(()=>u.value==="stopped");return(i,e)=>(r(),y(l(W),{class:"printer-card",hoverable:""},{header:n(()=>[c("div",ee,[c("span",{class:T(["status-dot",P.value])},null,2),c("span",te,w(a.printer.name),1),a.printer.isDefault?(r(),y(l(Y),{key:0,type:"info",size:"tiny",bordered:!1,round:""},{default:n(()=>[...e[5]||(e[5]=[U(" 默认 ",-1)])]),_:1})):N("",!0),o(G,{status:u.value},null,8,["status"])])]),action:n(()=>[o(l(V),{size:"small"},{default:n(()=>[a.printer.isDefault?N("",!0):(r(),y(l(C),{key:0,size:"small",quaternary:"",loading:t.actionLoading==="setDefault",disabled:!!t.actionLoading,onClick:e[0]||(e[0]=b=>m("setDefault",a.printer.name))},{default:n(()=>[...e[11]||(e[11]=[U(" 设为默认 ",-1)])]),_:1},8,["loading","disabled"])),L.value?(r(),y(l(C),{key:1,size:"small",quaternary:"",type:"success",loading:t.actionLoading==="enable",disabled:!!t.actionLoading,onClick:e[1]||(e[1]=b=>m("enable",a.printer.name))},{default:n(()=>[...e[12]||(e[12]=[U(" 启用 ",-1)])]),_:1},8,["loading","disabled"])):(r(),y(l(C),{key:2,size:"small",quaternary:"",type:"warning",loading:t.actionLoading==="disable",disabled:!!t.actionLoading,onClick:e[2]||(e[2]=b=>m("disable",a.printer.name))},{default:n(()=>[...e[13]||(e[13]=[U(" 停用 ",-1)])]),_:1},8,["loading","disabled"])),o(l(C),{size:"small",quaternary:"",type:"info",disabled:!!t.actionLoading,onClick:e[3]||(e[3]=b=>m("edit",a.printer))},{default:n(()=>[...e[14]||(e[14]=[U(" 编辑 ",-1)])]),_:1},8,["disabled"]),o(l(C),{size:"small",quaternary:"",type:"error",loading:t.actionLoading==="delete",disabled:!!t.actionLoading,onClick:e[4]||(e[4]=b=>m("delete",a.printer.name))},{default:n(()=>[...e[15]||(e[15]=[U(" 删除 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),default:n(()=>[c("div",ae,[a.printer.model?(r(),g("div",le,[e[6]||(e[6]=c("span",{class:"detail-label"},"型号",-1)),c("span",ie,w(a.printer.model),1)])):N("",!0),a.printer.description?(r(),g("div",se,[e[7]||(e[7]=c("span",{class:"detail-label"},"描述",-1)),c("span",ne,w(a.printer.description),1)])):N("",!0),a.printer.location?(r(),g("div",re,[e[8]||(e[8]=c("span",{class:"detail-label"},"位置",-1)),c("span",de,w(a.printer.location),1)])):N("",!0),a.printer.deviceUri?(r(),g("div",oe,[e[9]||(e[9]=c("span",{class:"detail-label"},"URI",-1)),c("span",ue,w(a.printer.deviceUri),1)])):N("",!0),a.printer.statusMessage?(r(),g("div",ce,[e[10]||(e[10]=c("span",{class:"detail-label"},"状态",-1)),c("span",ve,w(a.printer.statusMessage),1)])):N("",!0)])]),_:1}))}},fe=I(pe,[["__scopeId","data-v-e62be4e3"]]),me={key:1,class:"readonly-value"},be={key:1,class:"readonly-value"},ye={__name:"PrinterModal",props:{visible:{type:Boolean,default:!1},mode:{type:String,default:"add"},printer:{type:Object,default:null}},emits:["update:visible","saved"],setup(a,{emit:f}){const t=a,m=f,u=B(),P=E(),L=D(null),i=D(!1),e=D({name:"",deviceUri:"",model:"",description:"",location:""}),b={name:[{required:!0,message:"请输入打印机名称",trigger:"blur"}],deviceUri:[{required:!0,message:"请输入设备 URI",trigger:"blur"}]};F(()=>t.visible,k=>{k&&(t.mode==="edit"&&t.printer?e.value={name:t.printer.name||"",deviceUri:t.printer.deviceUri||"",model:t.printer.model||"",description:t.printer.description||"",location:t.printer.location||""}:e.value={name:"",deviceUri:"",model:"",description:"",location:""})});function h(k){i.value||k||m("update:visible",!1)}async function R(){var k,d,v,M;try{await((k=L.value)==null?void 0:k.validate())}catch{return}i.value=!0;try{t.mode==="add"?(await u.addPrinter(e.value),P.success("打印机已添加")):(await u.updatePrinter(e.value.name,{deviceUri:((d=e.value.deviceUri)==null?void 0:d.trim())||void 0,description:((v=e.value.description)==null?void 0:v.trim())||void 0,location:((M=e.value.location)==null?void 0:M.trim())||void 0}),P.success("打印机已更新")),m("saved"),m("update:visible",!1)}catch(q){P.error(q.message||"操作失败")}finally{i.value=!1}}return(k,d)=>(r(),y(l(J),{show:a.visible,preset:"card",title:a.mode==="add"?"添加打印机":"编辑打印机",style:{"max-width":"480px",width:"90vw"},"mask-closable":!i.value,closable:!i.value,"onUpdate:show":h},{action:n(()=>[o(l(V),{justify:"end"},{default:n(()=>[o(l(C),{disabled:i.value,onClick:d[5]||(d[5]=v=>h(!1))},{default:n(()=>[...d[6]||(d[6]=[U(" 取消 ",-1)])]),_:1},8,["disabled"]),o(l(C),{type:"primary",loading:i.value,onClick:R},{default:n(()=>[U(w(a.mode==="add"?"添加":"保存"),1)]),_:1},8,["loading"])]),_:1})]),default:n(()=>[o(l(Z),{ref_key:"formRef",ref:L,model:e.value,rules:b,"label-placement":"left","label-width":"80"},{default:n(()=>[o(l($),{label:"名称",path:"name"},{default:n(()=>[a.mode==="add"?(r(),y(l(x),{key:0,value:e.value.name,"onUpdate:value":d[0]||(d[0]=v=>e.value.name=v),placeholder:"打印机名称",disabled:i.value},null,8,["value","disabled"])):(r(),g("span",me,w(e.value.name),1))]),_:1}),o(l($),{label:"URI",path:"deviceUri"},{default:n(()=>[o(l(x),{value:e.value.deviceUri,"onUpdate:value":d[1]||(d[1]=v=>e.value.deviceUri=v),placeholder:"如: ipp://192.168.1.100:631/printers/HP",disabled:i.value},null,8,["value","disabled"])]),_:1}),o(l($),{label:"型号",path:"model"},{default:n(()=>[a.mode==="add"?(r(),y(l(x),{key:0,value:e.value.model,"onUpdate:value":d[2]||(d[2]=v=>e.value.model=v),placeholder:"可选",disabled:i.value},null,8,["value","disabled"])):(r(),g("span",be,w(e.value.model||"--"),1))]),_:1}),o(l($),{label:"描述",path:"description"},{default:n(()=>[o(l(x),{value:e.value.description,"onUpdate:value":d[3]||(d[3]=v=>e.value.description=v),placeholder:"可选",disabled:i.value},null,8,["value","disabled"])]),_:1}),o(l($),{label:"位置",path:"location"},{default:n(()=>[o(l(x),{value:e.value.location,"onUpdate:value":d[4]||(d[4]=v=>e.value.location=v),placeholder:"可选，如: 3楼办公区",disabled:i.value},null,8,["value","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","mask-closable","closable"]))}},ge=I(ye,[["__scopeId","data-v-86d39043"]]),ke={class:"printer-list-view"},we={class:"view-header"},Ue={key:0,class:"printer-grid"},Pe={__name:"PrinterListView",setup(a){const f=B(),t=E(),m=_(),u=K(new Map),P=D(null);function L(s){return u.get(s)||""}const i=D(!1),e=D("add"),b=D(null);A(()=>{f.loadPrinters()});async function h(){var s;try{await f.loadPrinters()}finally{(s=P.value)==null||s.done()}}function R(){e.value="add",b.value=null,i.value=!0}function k(s){e.value="edit",b.value=s,i.value=!0}function d(){}function v(s){m.warning({title:"确认删除",content:'确定要删除打印机 "'+s+'" 吗？此操作不可撤销。',positiveText:"删除",negativeText:"取消",onPositive:async()=>{u.set(s,"delete");try{await f.deletePrinter(s),t.success("打印机已删除")}catch(p){t.error(p.message||"删除失败")}finally{u.delete(s)}}})}async function M(s){u.set(s,"setDefault");try{await f.setDefault(s),t.success("已设为默认打印机")}catch(p){t.error(p.message||"操作失败")}finally{u.delete(s)}}async function q(s){u.set(s,"enable");try{await f.enable(s),t.success("打印机已启用")}catch(p){t.error(p.message||"操作失败")}finally{u.delete(s)}}async function j(s){u.set(s,"disable");try{await f.disable(s),t.success("打印机已停用")}catch(p){t.error(p.message||"操作失败")}finally{u.delete(s)}}return(s,p)=>(r(),g("div",ke,[c("div",we,[p[2]||(p[2]=c("h2",{class:"view-title"},"打印机管理",-1)),o(l(C),{type:"primary",onClick:R},{default:n(()=>[...p[1]||(p[1]=[U(" 添加打印机 ",-1)])]),_:1})]),o(Q,{ref_key:"printerPullRefresh",ref:P,onRefresh:h},{default:n(()=>[l(f).printers.length?(r(),g("div",Ue,[(r(!0),g(O,null,H(l(f).printers,S=>(r(),y(fe,{key:S.name,printer:S,"action-loading":L(S.name),onEdit:k,onDelete:v,onSetDefault:M,onEnable:q,onDisable:j},null,8,["printer","action-loading"]))),128))])):(r(),y(l(X),{key:1,description:"暂无打印机，请点击上方按钮添加",class:"empty-state"}))]),_:1},512),o(ge,{visible:i.value,"onUpdate:visible":p[0]||(p[0]=S=>i.value=S),mode:e.value,printer:b.value,onSaved:d},null,8,["visible","mode","printer"])]))}},qe=I(Pe,[["__scopeId","data-v-c9acb130"]]);export{qe as default};
